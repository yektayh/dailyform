<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Task Form</title>
</head>
<body>
  <form id="dataForm">
    <label for="nameSelect">نام:</label>
    <select id="nameSelect" required>
      <option value="" disabled selected>انتخاب کنید</option>
      <option value="Ali">علی</option>
      <option value="Sara">سارا</option>
      <!-- گزینه‌های دیگر بر حسب نیاز -->
    </select>
    <br /><br />

    <label for="dateInput">تاریخ (شمسی):</label>
    <input type="text" id="dateInput" placeholder="مثلاً 1402/01/15" required />
    <br /><br />

    <label for="weekdayInput">روز هفته:</label>
    <select id="weekdayInput" required>
      <option value="" disabled selected>انتخاب روز</option>
      <option value="شنبه">شنبه</option>
      <option value="یکشنبه">یک‌شنبه</option>
      <option value="دوشنبه">دوشنبه</option>
      <option value="سه\u200cشنبه">سه‌شنبه</option>
      <option value="چهارشنبه">چهارشنبه</option>
      <option value="پنج\u200cشنبه">پنج‌شنبه</option>
      <option value="جمعه">جمعه</option>
    </select>
    <br /><br />

    <strong>وظایف:</strong>
    <div id="tasksList">
      <!-- یک ردیف وظیفه به صورت پیش‌فرض -->
      <div class="task-item">
        <input type="text" class="taskName" placeholder="وظیفه" required />
        <input type="text" class="taskStatus" placeholder="وضعیت" required />
        <input type="text" class="taskDuration" placeholder="مدت" />
        <input type="text" class="taskNote" placeholder="یادداشت" />
        <button type="button" class="removeTask">حذف</button>
      </div>
    </div>
    <button type="button" id="addTaskBtn">افزودن وظیفه</button>
    <br /><br />

    <button type="submit">ارسال</button>
    <p id="statusMessage"></p>
  </form>

  <script>
    const form = document.getElementById('dataForm');
    const tasksList = document.getElementById('tasksList');
    const statusMessage = document.getElementById('statusMessage');
    const addTaskBtn = document.getElementById('addTaskBtn');

    // افزودن ردیف جدید وظیفه
    addTaskBtn.addEventListener('click', function () {
      const item = document.createElement('div');
      item.className = 'task-item';
      item.innerHTML = 
        '<input type="text" class="taskName" placeholder="وظیفه" required /> ' +
        '<input type="text" class="taskStatus" placeholder="وضعیت" required /> ' +
        '<input type="text" class="taskDuration" placeholder="مدت" /> ' +
        '<input type="text" class="taskNote" placeholder="یادداشت" /> ' +
        '<button type="button" class="removeTask">حذف</button>';
      // رویداد حذف وظیفه
      item.querySelector('.removeTask').addEventListener('click', function () {
        // حداقل یک وظیفه باید باقی بماند
        if (tasksList.children.length > 1) {
          item.remove();
        }
      });
      tasksList.appendChild(item);
    });

    // ارسال فرم با استفاده از fetch
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      // ساختاردهی داده‌ها
      const data = {
        name: document.getElementById('nameSelect').value,
        date: document.getElementById('dateInput').value,
        weekday: document.getElementById('weekdayInput').value,
        tasks: []
      };
      // جمع‌آوری آرایه وظایف
      document.querySelectorAll('#tasksList .task-item').forEach(function(item) {
        data.tasks.push({
          task: item.querySelector('.taskName').value.trim(),
          status: item.querySelector('.taskStatus').value.trim(),
          duration: item.querySelector('.taskDuration').value.trim(),
          note: item.querySelector('.taskNote').value.trim()
        });
      });

      // ارسال درخواست به submit.php
      const url = 'https://shahreargham.com/submit.php';  // ← آدرس صحیح submit.php را قرار دهید
      fetch(url, {
        method: 'POST',
        mode: 'cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(result => {
        if (result.result === 'success') {
          // موفقیت‌آمیز
          statusMessage.style.color = 'green';
          statusMessage.textContent = 'اطلاعات با موفقیت ثبت شد.';
        } else {
          // خطا از سمت سرور یا اسکریپت Google
          statusMessage.style.color = 'red';
          // اگر پیام خطا موجود باشد، همان را نمایش می‌دهیم؛ در غیر این صورت پیام پیش‌فرض
          statusMessage.textContent = result.message ? result.message : 'خطایی رخ داد. لطفاً دوباره تلاش کنید.';
        }
      })
      .catch(error => {
        // خطا در اتصال (مثلاً قطع بودن اینترنت یا مشکل CORS)
        statusMessage.style.color = 'red';
        statusMessage.textContent = 'خطا در ارتباط با سرور. لطفاً دوباره تلاش کنید.';
        console.error('Fetch error:', error);
      });
    });
  </script>
</body>
</html>
